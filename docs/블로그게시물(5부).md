## ğŸ¤” ë“¤ì–´ê°€ë©°

[**4ë¶€**ì—ì„œëŠ” Rollupì„ ì´ìš©í•´ ESMê³¼ CommonJSë¥¼ ëª¨ë‘ ì§€ì›í•˜ëŠ” ë“€ì–¼ íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ì—ˆë‹¤.](https://velog.io/@dannysir/JavaScript-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EB%A7%8C%EB%93%A4%EA%B8%B0-4%EB%B6%80)

ì´ì „ í¬ìŠ¤íŠ¸ê¹Œì§€ê°€Â `v0.2.x`Â ë²„ì „ì˜ ì£¼ìš” ë³€ê²½ ì‚¬í•­ì´ì—ˆë‹¤ë©´, ì´ë²ˆ í¬ìŠ¤íŠ¸ë¶€í„°ëŠ”Â `v0.3.x`Â ë²„ì „ì˜ ì£¼ìš” ë³€ê²½ ì‚¬í•­ì„ ì‚´í´ë³¼ ê²ƒì´ë‹¤.

**"mockì„ ë“±ë¡í•œ í›„ì— ë°˜ë“œì‹œ ë™ì  importë¥¼ í•´ì•¼ í•œë‹¤"**

```jsx
// ì´ë ‡ê²Œ í•´ì•¼ë§Œ ë™ì‘í•¨ ğŸ˜¢
test('mocking test', async () => {
  mock('/absolute/path/random.js', {
    random: () => 3
  });

  // mock ì´í›„ì— ë™ì  import í•„ìˆ˜!
  const { play } = await import('./game.js');

  expect(play()).toBe(30);
});

```

JestëŠ” importë¥¼ ìµœìƒë‹¨ì— ì‘ì„±í•´ë„ ëª¨í‚¹ì´ ì˜ ë™ì‘í•˜ëŠ”ë°, ì™œ ìš°ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì•ˆ ë ê¹Œ?

ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì´ ë¬¸ì œë¥¼ ë¶„ì„í•˜ê³ Â **Wrapper íŒ¨í„´**ìœ¼ë¡œ í•´ê²°í•˜ëŠ” ê³¼ì •ì„ ë‹¤ë£¬ë‹¤.

## ğŸ’¡ ë¬¸ì œ ìƒí™© ë¶„ì„

### ğŸ“‹ ì™œ ë™ì  importë¥¼ ì¨ì•¼ í• ê¹Œ?

í˜„ì¬ êµ¬ì¡°ë¥¼ ë‹¤ì‹œ ì‚´í´ë³´ì.

```jsx
// game.js
import { random } from './random.js';

export const play = () => {
  return random() * 10;
};
```

```jsx
// game.test.js
import { play } from './game.js';  // âŒ ì´ ìˆœê°„ ì´ë¯¸ ë¡œë“œë¨

test('mocking test', () => {
  mock('/path/random.js', { random: () => 3 });
  // ì´ë¯¸ ë¡œë“œëœ game.jsëŠ” ì›ë³¸ randomì„ ì°¸ì¡° ì¤‘

  expect(play()).toBe(30);  // ì‹¤íŒ¨!
});
```

**ë¬¸ì œì˜ í•µì‹¬**

1. JavaScript íŒŒì¼ì´ ì‹¤í–‰ë˜ë©´Â **ìµœìƒë‹¨ì˜ importê°€ ë¨¼ì € ì‹¤í–‰**ë¨
2. ì´ ì‹œì ì—Â `game.js`ê°€ ë¡œë“œë˜ê³ ,Â `game.js`Â ë‚´ë¶€ì˜Â `random.js`ë„ ë¡œë“œë¨
3. í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ë•ŒëŠ”Â **ì´ë¯¸ ëª¨ë“  ëª¨ë“ˆì´ ë¡œë“œëœ ìƒíƒœ**
4. mockì„ ë“±ë¡í•´ë„Â **ì´ë¯¸ ë¡œë“œëœ ëª¨ë“ˆì€ ë³€ê²½ ë¶ˆê°€**

**í˜„ì¬ í•´ê²°ì±…: ë™ì  import**

```jsx
test('mocking test', async () => {
  mock('/path/random.js', { random: () => 3 });

  // ì´ ì‹œì ì— ì²˜ìŒìœ¼ë¡œ game.js ë¡œë“œ
  const { play } = await import('./game.js');

  expect(play()).toBe(30);  // ì„±ê³µ!
});

```

í•˜ì§€ë§Œ ì´ ë°©ì‹ì€ ì‚¬ìš©ì„±ì´ ë–¨ì–´ì§„ë‹¤

- ë§¤ë²ˆÂ `async/await`Â ì‘ì„± í•„ìš”
- importë¥¼ ìµœìƒë‹¨ì— ì‘ì„±í•˜ëŠ” ì¼ë°˜ì ì¸ íŒ¨í„´ê³¼ ë‹¤ë¦„

### ğŸ“‹ JestëŠ” ì–´ë–»ê²Œ í•´ê²°í–ˆì„ê¹Œ?

Jestì˜ ë™ì‘ì„ ì‚´í´ë³´ë©´:

```jsx
// Jestì—ì„œëŠ” ì´ê²Œ ê°€ëŠ¥í•¨!
import { play } from './game.js';

jest.mock('./random.js', () => ({
  random: () => 3
}));

test('mocking test', () => {
  expect(play()).toBe(30);  // ì„±ê³µ!
});
```

**Jestì˜ í•´ê²° ì „ëµ**

JestëŠ” **mock í˜¸ì´ìŠ¤íŒ…(hoisting)**ì„ ì‚¬ìš©í•œë‹¤.

> ğŸ’¡Â ì°¸ê³ :Â [Jestì˜ babel-plugin-jest-hoist](https://github.com/jestjs/jest/tree/main/packages/babel-plugin-jest-hoist)
>
1. í…ŒìŠ¤íŠ¸ íŒŒì¼ì„ ë¶„ì„í•˜ì—¬ ëª¨ë“ Â `jest.mock()`Â í˜¸ì¶œì„ ì°¾ìŒ
2. ì½”ë“œ ì‹¤í–‰ ì „ì— mockì„ ë¨¼ì € ë“±ë¡
3. ì´í›„ importê°€ ì‹¤í–‰ë  ë•Œ ì´ë¯¸ mockì´ ì¤€ë¹„ëœ ìƒíƒœ

```jsx
// ì‹¤ì œ ì‹¤í–‰ ìˆœì„œ
// 1. jest.mock() í˜¸ì¶œ (ì½”ë“œ ìµœìƒë‹¨ë³´ë‹¤ ë¨¼ì €!)
// 2. import ë¬¸ ì‹¤í–‰
// 3. í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì‹¤í–‰
```

### ğŸ“‹ Mock í˜¸ì´ìŠ¤íŒ…ì˜ ë¬¸ì œì 

ê·¸ë ‡ë‹¤ë©´ Jestì²˜ëŸ¼ mock í˜¸ì´ìŠ¤íŒ…ì„ êµ¬í˜„í•˜ë©´ ë ê¹Œ?

ë¬¼ë¡  í˜¸ì´ìŠ¤íŒ… ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë©´ importë¬¸ì„ ìµœìƒë‹¨ì— ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

ê·¸ëŸ¬ë‚˜ í˜¸ì´ìŠ¤íŒ…ì„ ì´ìš©í•˜ë©´ ë˜ **ë‹¤ë¥¸ ì˜¤ë¥˜**ê°€ ìƒê¸°ëŠ” ê²ƒì„ ì˜ˆìƒí•  ìˆ˜ ìˆë‹¤.

**ë¬¸ì œ ìƒí™©**

í˜„ì¬ ìš°ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ `mock`ì€ ê°ê°ì˜Â `test`Â ë‚´ë¶€ì—ì„œ ì„ ì–¸ë˜ì–´Â **í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ ë‚´ì—ì„œë§Œ ì˜í–¥**ì„ ë¼ì¹œë‹¤.

```jsx
describe('Tests', () => {
  test('test 1', () => {
    mock('/path/random.js', { random: () => 3 });
    // test 1ì—ì„œë§Œ mock ì ìš©
  });

  test('test 2', () => {
    // test 2ëŠ” ì›ë³¸ random ì‚¬ìš©
    // test 1ì˜ mock ì˜í–¥ ë°›ì§€ ì•ŠìŒ
  });
});

```

ê·¸ëŸ¬ë‚˜ ë§Œì•½ mockì´ í˜¸ì´ìŠ¤íŒ…ë˜ì–´ ì‚¬ìš©ë˜ë©´

```jsx
// mockì´ í˜¸ì´ìŠ¤íŒ…ë˜ë©´...
mock('/path/random.js', { random: () => 3 });  // ìµœìƒë‹¨ìœ¼ë¡œ ì´ë™
import {random} from '/path/random.js'; // mock ì´í›„ì— import

describe('Tests', () => {
  test('test 1', () => {
    // mock ì ìš©ë¨
  });

  test('test 2', () => {
    // âŒ ì˜ë„í•˜ì§€ ì•Šì•˜ì§€ë§Œ mockì´ ì ìš©ë¨!
  });
});

```

**ë¬¸ì œì˜ í•µì‹¬**

- íŠ¹ì • í…ŒìŠ¤íŠ¸ì—ì„œë§Œ ëª¨í‚¹í•˜ê³  ì‹¶ì–´ë„Â **ëª¨ë“  í…ŒìŠ¤íŠ¸ì— ì˜í–¥**
- ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ ê²°ê³¼

Jestì˜ ê²½ìš° ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´

- ë³µì¡í•œ ëª¨ë“ˆ ìºì‹± ì‹œìŠ¤í…œ êµ¬í˜„
- ê° í…ŒìŠ¤íŠ¸ íŒŒì¼ë§ˆë‹¤ ë…ë¦½ì ì¸ ëª¨ë“ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ìœ ì§€

## ğŸ’¡ ìƒˆë¡œìš´ ì ‘ê·¼: Wrapper íŒ¨í„´

Mock í˜¸ì´ìŠ¤íŒ… ë°©ë²•ì„ ì°¾ë‹¤ê°€ ë¬¸ë“ í•œ ê°€ì§€ ìƒê°ì´ ë“¤ì—ˆë‹¤.

**"ëª¨ë“ˆì„ í•¨ìˆ˜ë¡œ ê°ì‹¸ì„œ í˜¸ì¶œ ì‹œë§ˆë‹¤ mockStoreë¥¼ í™•ì¸í•˜ê²Œ ë§Œë“¤ë©´ ì–´ë–¨ê¹Œ?"**

ë§Œì•½ ëª¨ë“ˆì„ íŠ¹ì • íŒ¨í„´ìœ¼ë¡œ ê°ì‹¸ì„œ wrapper í•¨ìˆ˜ë¡œ ë§Œë“¤ë©´,

í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ë•Œë§ˆë‹¤Â `mockStore`ë¥¼ ê²€ì‚¬í•˜ì—¬ ìƒí™©ì— ë§ëŠ” ëª¨ë“ˆì„ ë°˜í™˜í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ?

### ğŸ“‹ í•µì‹¬ ì•„ì´ë””ì–´

**ê¸°ì¡´ ë°©ì‹**

```jsx
// ë³€í™˜ ê²°ê³¼
const _module = mockStore.has('/path/random.js')
  ? mockStore.get('/path/random.js')
  : await import('./random.js');
const { random } = _module;

// ë¬¸ì œ: import ì‹œì ì— mockStoreë¥¼ í•œ ë²ˆë§Œ ì²´í¬

```

**ìƒˆë¡œìš´ ë°©ì‹**

```jsx
// ë³€í™˜ ê²°ê³¼
const _original = await import('./random.js');
const random = (...args) => {
  const module = mockStore.has('/path/random.js')
    ? { ..._original, ...mockStore.get('/path/random.js') }
    : _original;
  return module.random(...args);
};

// random() í˜¸ì¶œ ì‹œë§ˆë‹¤ mockStoreë¥¼ ì²´í¬!

// ì¶”ê°€ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ë§ˆë‹¤ mockStoreë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ë¡œì§ í•„ìˆ˜
```

**ì°¨ì´ì **

- **ê¸°ì¡´**: import ì‹œì ì— mockStore í™•ì¸ â†’ ì´í›„ ë³€ê²½ ë¶ˆê°€
- **ìƒˆë°©ì‹**: í•¨ìˆ˜ ì‹¤í–‰ ì‹œë§ˆë‹¤ mockStore í™•ì¸ â†’ ì–¸ì œë“  mock ì ìš© ê°€ëŠ¥

### ğŸ“‹ ë™ì‘ ì›ë¦¬

```jsx
// 1. íŒŒì¼ ë¡œë“œ ì‹œì 
import { random } from './random.js';
// â†“ Babel ë³€í™˜
const _original = await import('./random.js');  // ì›ë³¸ ì €ì¥
const random = (...args) => {                   // wrapper í•¨ìˆ˜ ìƒì„±
  // ì´ ë¶€ë¶„ì€ ì•„ì§ ì‹¤í–‰ ì•ˆ ë¨!
};

// 2. í…ŒìŠ¤íŠ¸ ì‹œì‘
test('test', () => {
  // 3. mock ë“±ë¡
  mock('/path/random.js', { random: () => 3 });

  // 4. random() í˜¸ì¶œ
  const result = random();  // wrapper í•¨ìˆ˜ ì‹¤í–‰
  // â†“
  // wrapper ë‚´ë¶€ì—ì„œ mockStore ì²´í¬
  // mockStoreì— '/path/random.js'ê°€ ìˆìŒ!
  // mock í•¨ìˆ˜ ì‚¬ìš©: () => 3

  expect(result).toBe(3);  // ì„±ê³µ!
});

```

**í…ŒìŠ¤íŠ¸ê°€ ë¶„ë¦¬ë˜ì–´ ì‹¤í–‰ë¨**

```jsx
describe('Tests', () => {
  test('test 1', () => {
    mock('/path/random.js', { random: () => 3 });

    const result = random();  // wrapperê°€ mockStore ì²´í¬ â†’ mock ì‚¬ìš©
    expect(result).toBe(3);   // âœ… ì„±ê³µ
  });

  test('test 2', () => {
    // mock ë“±ë¡ ì•ˆ í•¨
    const result = random();  // wrapperê°€ mockStore ì²´í¬ â†’ ì›ë³¸ ì‚¬ìš©
    expect(result).toBe(???); // âœ… ì›ë³¸ random() ì‹¤í–‰
  });
});

```

ê° í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ë  ë•Œë§ˆë‹¤ wrapper í•¨ìˆ˜ê°€Â `mockStore`ë¥¼ í™•ì¸í•˜ë¯€ë¡œ

- test 1: mockì´ ë“±ë¡ë˜ì–´ ìˆìŒ â†’ mock ì‚¬ìš©
- test 2: mockì´ ë“±ë¡ë˜ì§€ ì•ŠìŒ â†’ ì›ë³¸ ì‚¬ìš©

í…ŒìŠ¤íŠ¸ ê°„ ëª¨í‚¹ì´ ë³„ë„ë¡œ ìœ ì§€ëœë‹¤

## ğŸ’¡ Babel í”ŒëŸ¬ê·¸ì¸ ì¬êµ¬í˜„

ê·¸ëŸ¼ ì´ì œ ì•ì„œ ì„¤ê³„í•œ Wrapper íŒ¨í„´ì— ë§ê²Œ Babel í”ŒëŸ¬ê·¸ì¸ì„ êµ¬í˜„í•´ì•¼ í•œë‹¤.

ê·¸ëŸ¬ë‚˜ í•´ë‹¹ ê³¼ì •ì€ ì´ì „ì— ì‘ì„±í–ˆë˜Â [2ë¶€ í¬ìŠ¤íŠ¸ì˜ Babel í”ŒëŸ¬ê·¸ì¸ êµ¬í˜„í•˜ê¸°](https://velog.io/@dannysir/JavaScript-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EB%A7%8C%EB%93%A4%EA%B8%B0-2%EB%B6%80#-babel-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0)ì™€ ê±°ì˜ ë™ì¼í•œ ê³¼ì •ì´ê¸° ë•Œë¬¸ì—, ì´ë²ˆì—ëŠ” ë³€í™˜ ê²°ê³¼ì™€ ë™ì‘ ì›ë¦¬ ìœ„ì£¼ë¡œ ì„¤ëª…í•˜ê² ë‹¤.

> ğŸ˜ŠÂ ì „ì²´ Babel í”ŒëŸ¬ê·¸ì¸ ì½”ë“œëŠ”Â [GitHub ë ˆí¬ì§€í† ë¦¬ë¥¼ ì°¸ê³ ](https://github.com/dannysir/js-te-package/blob/main/babelTransformImport.js)
>

### ğŸ“‹ ì£¼ìš” ë³€ê²½ ì‚¬í•­

**ì´ì „ ë°©ì‹**

```jsx
// import ì‹œì ì— í•œ ë²ˆë§Œ ì²´í¬
const _module = mockStore.has('/path')
  ? mockStore.get('/path')
  : await import('./random.js');
const { random } = _module;

```

**ìƒˆë¡œìš´ ë°©ì‹**

```jsx
// í•¨ìˆ˜ í˜¸ì¶œ ì‹œë§ˆë‹¤ ì²´í¬
const _original = await import('./random.js');
const random = (...args) => {
  const module = mockStore.has('/path')
    ? { ..._original, ...mockStore.get('/path') }
    : _original;
  return module.random(...args);
};

```

**í•µì‹¬ ì°¨ì´ì **

1. ì›ë³¸ ëª¨ë“ˆì„Â `_original`ì— ë¨¼ì € ì €ì¥
2. ê° í•¨ìˆ˜ë¥¼ wrapperë¡œ ê°ì‹¸ì„œ ì¬ì •ì˜
3. Wrapper ë‚´ë¶€ì—ì„œ mockStore ì²´í¬
4. ìŠ¤í”„ë ˆë“œ ì—°ì‚°ìë¡œ ì›ë³¸ê³¼ mock ë³‘í•© (ë¶€ë¶„ ëª¨í‚¹ ì§€ì›)

### ğŸ“‹ ì „ì²´ ë³€í™˜ ì˜ˆì‹œ

**ë³€í™˜ ì „**

```jsx
import { random } from './random.js';
import { add, subtract } from './math.js';
import * as utils from './utils.js';

```

**ë³€í™˜ í›„**

```jsx
const mockStore = global.mockStore;

const _original = await import('./random.js');
const random = (...args) => {
  const module = mockStore.has('/absolute/path/random.js')
    ? { ..._original, ...mockStore.get('/absolute/path/random.js') }
    : _original;
  return module.random(...args);
};

const _original2 = await import('./math.js');
const add = (...args) => {
  const module = mockStore.has('/absolute/path/math.js')
    ? { ..._original2, ...mockStore.get('/absolute/path/math.js') }
    : _original2;
  return module.add(...args);
};
const subtract = (...args) => {
  const module = mockStore.has('/absolute/path/math.js')
    ? { ..._original2, ...mockStore.get('/absolute/path/math.js') }
    : _original2;
  return module.subtract(...args);
};

const _original3 = await import('./utils.js');
const utils = mockStore.has('/absolute/path/utils.js')
  ? { ..._original3, ...mockStore.get('/absolute/path/utils.js') }
  : _original3;

```

### ğŸ“‹ ì‚¬ìš© ì˜ˆì‹œ

ì´ì œ ë“œë””ì–´ Jestì²˜ëŸ¼ importë¥¼ ìµœìƒë‹¨ì— ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

```jsx
// random.js
export const random = () => Math.random();

// game.js
import { random } from './random.js';

export const play = () => random() * 10;

// game.test.js
import { play } from './game.js';  // âœ… ìµœìƒë‹¨ì— ì‘ì„± ê°€ëŠ¥!

test('[mocking] - mocking random function', () => {
  mock('/Users/san/Js-Te/random.js', {
    random: () => 3
  });

  expect(play()).toBe(30);  // ì„±ê³µ!
});

```

**ë™ì‘ ê³¼ì •**

1. **íŒŒì¼ ë¡œë“œ ì‹œ**:
    - `game.js`Â import â†’ Babel ë³€í™˜
    - `random`Â wrapper í•¨ìˆ˜ ìƒì„±
    - ì›ë³¸Â `random`Â ì €ì¥
2. **í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ**:
    - `mock()`Â í˜¸ì¶œ â†’ mockStoreì— ë“±ë¡
    - `play()`Â í˜¸ì¶œ
    - `play()`Â ë‚´ë¶€ì—ì„œÂ `random()`Â í˜¸ì¶œ
    - `random`Â wrapper í•¨ìˆ˜ ì‹¤í–‰
    - mockStore ì²´í¬ â†’ mock í•¨ìˆ˜ ì‚¬ìš©
    - `3 * 10 = 30`Â ë°˜í™˜

## ğŸ’¡ ìµœì í™”ì˜ í•„ìš”ì„±

### ğŸ“‹ ë¬¸ì œì 

ì—¬ê¸°ê¹Œì§€ í•˜ë©´ ëª©í‘œëŠ” ëª¨ë‘ ë‹¬ì„±í–ˆë‹¤.

í•˜ì§€ë§Œ í˜„ì¬ ë¡œì§ì˜ ë™ì‘ ê³¼ì •ì€ ì „ì²´ ë¡œì§ ë‚´ì˜ importë¬¸ì„ Wrapper íŒ¨í„´ìœ¼ë¡œ ê°ì‹¼ë‹¤ëŠ” ë¬¸ì œê°€ ìˆë‹¤.

```jsx
// mockí•˜ì§€ ì•ŠëŠ” ëª¨ë“ˆë„ wrapperë¡œ ë³€í™˜ë¨
import { someFunction } from './normal-module.js';
// â†“
const someFunction = (...args) => {
  // ë§¤ë²ˆ mockStore ì²´í¬ (ë¶ˆí•„ìš”!)
  const module = mockStore.has('/path/normal-module.js')
    ? { ..._original, ...mockStore.get('/path/normal-module.js') }
    : _original;
  return module.someFunction(...args);
};

```

### ğŸ“‹ mock í˜¸ì´ìŠ¤íŒ…ì„ ì°¸ê³ í•œ í•´ê²°ì±…

ì—¬ê¸°ì„œ Jestì—ì„œ ë´¤ë˜ mock í˜¸ì´ìŠ¤íŒ… ê¸°ëŠ¥ì˜ ì•„ì´ë””ì–´ë¥¼ ì°¸ê³ í–ˆë‹¤.

**1ë‹¨ê³„: í…ŒìŠ¤íŠ¸ íŒŒì¼ ë¶„ì„**

ë¨¼ì € ëª¨ë“  í…ŒìŠ¤íŠ¸ íŒŒì¼ì„ ìŠ¤ìº”í•˜ì—¬

`mockedPaths` ì— ëª¨í‚¹ì´ëœ ê²½ë¡œë¥¼ ë¯¸ë¦¬ ì €ì¥í•œë‹¤.

```jsx
// collectMocks.js
export const collectMockedPaths = (testFiles) => {
  const mockedPaths = new Set();

  for (const file of testFiles) {
    const code = fs.readFileSync(file, 'utf-8');

    // Babelë¡œ íŒŒì‹±
    const ast = parse(code, {
      sourceType: 'module',
      plugins: ['dynamicImport']
    });

    // mock() í˜¸ì¶œ ì°¾ê¸°
    traverse(ast, {
      CallExpression(path) {
        if (path.node.callee.name === 'mock') {
          const mockPath = path.node.arguments[0].value;
          const absolutePath = resolveAbsolutePath(mockPath, file);
          mockedPaths.add(absolutePath);
        }
      }
    });
  }

  return mockedPaths;
};

```

**2ë‹¨ê³„: CLIì—ì„œ í”ŒëŸ¬ê·¸ì¸ì— ì „ë‹¬**

```jsx
// cli.js
const main = async () => {
  const testFiles = findTestFiles(process.cwd());

  // 1. mockëœ ê²½ë¡œ ìˆ˜ì§‘
  const mockedPaths = collectMockedPaths(testFiles);

  // 2. ì†ŒìŠ¤ íŒŒì¼ ë³€í™˜ (mockedPaths ì „ë‹¬)
  const sourceFiles = findAllSourceFiles(process.cwd());
  for (const file of sourceFiles) {
    transformFiles(file, mockedPaths);  // âœ… mockëœ ê²½ë¡œë§Œ ë³€í™˜
  }

  // 3. í…ŒìŠ¤íŠ¸ ì‹¤í–‰...
};

```

**3ë‹¨ê³„: Babel í”ŒëŸ¬ê·¸ì¸ì—ì„œ ì²´í¬**

```jsx
ImportDeclaration(nodePath, state) {
  const source = nodePath.node.source.value;
  const absolutePath = calculateAbsolutePath(source, state);

  // âœ… mock ëŒ€ìƒì´ ì•„ë‹ˆë©´ ë³€í™˜í•˜ì§€ ì•ŠìŒ
  if (mockedPaths && !mockedPaths.has(absolutePath)) {
    return;  // ì›ë³¸ import ê·¸ëŒ€ë¡œ ìœ ì§€
  }

  // mock ëŒ€ìƒë§Œ wrapperë¡œ ë³€í™˜
  // ...
}

```

**ê²°ê³¼**

```jsx
// mockë˜ëŠ” ëª¨ë“ˆ
import { random } from './random.js';
// â†“ wrapperë¡œ ë³€í™˜ë¨
const random = (...args) => { ... };

// mock ì•ˆ ë˜ëŠ” ëª¨ë“ˆ
import { normal } from './normal.js';
// â†“ ê·¸ëŒ€ë¡œ ìœ ì§€ë¨
import { normal } from './normal.js';

```

## ğŸ’¡Â ìµœì¢… ê²°ê³¼

```jsx
// math.js
export const add = (a, b) => a + b;
export const subtract = (a, b) => a - b;
export const multiply = (a, b) => a * b;

// math.test.js
const { add, subtract, multiply } = import('./math.js'); // 0.3.0 ë²„ì „ë¶€í„°ëŠ” ìµœìƒë‹¨ì— ì„ ì–¸ ê°€ëŠ¥

test('ë¶€ë¶„ ëª¨í‚¹ ì˜ˆì œ', async () => {
  mock('/Users/san/untitled/index.js', {
    multiply: () => 100
  });
  
  expect(add(2, 3)).toBe(5);      
  expect(subtract(5, 3)).toBe(2); 
  expect(multiply(2, 3)).toBe(100);
});
```

## ğŸ“ í”„ë¡œì íŠ¸ ë§í¬

- **GitHub:** https://github.com/dannysir/js-te-package
- **npm**: https://www.npmjs.com/package/@dannysir/js-te